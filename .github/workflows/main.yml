name: HyperExecute-Scheduled-Run

on:
  schedule:
    - cron: "55 2 * * 1"  # Runs at 2:55 AM UTC (8:25 AM IST) every Monday
  workflow_dispatch:
    inputs:
      username:
        description: "LT Username (Optional)"
        required: false
      accessKey:
        description: "LT Access Key (Optional)"
        required: false
      sampleRepoLink:
        description: "Link to the HyperExecute sample repo"
        default: "https://github.com/john190501/hyperexecute-failfast"
        required: true

jobs:
  HyperExecute-Run:
    runs-on: windows-latest
    timeout-minutes: 15

    steps:
      - name: Checkout Repository
        uses: actions/checkout@v2

      - name: Set Credentials
        run: |
          pwd
          echo "Setting up credentials..."
          if [ -n "${{ github.event.inputs.username }}" ]; then
            echo "Using provided credentials from input"
            echo "LT_USERNAME=${{ github.event.inputs.username }}" >> $GITHUB_ENV
            echo "LT_ACCESS_KEY=${{ github.event.inputs.accessKey }}" >> $GITHUB_ENV
          else
            echo "Using credentials from Secrets"
            echo "LT_USERNAME=${{ secrets.LT_USERNAME }}" >> $GITHUB_ENV
            echo "LT_ACCESS_KEY=${{ secrets.LT_ACCESS_KEY }}" >> $GITHUB_ENV
          fi
        shell: bash

      - name: Download Sample Project
        run: |
          pwd
          echo "Cloning repository..."
          git clone ${{ github.event.inputs.sampleRepoLink }}
        shell: bash

      - name: Install HyperExecute CLI
        run: |
          pwd
          echo "Downloading HyperExecute CLI..."
          cd hyperexecute-failfast
          curl -O https://downloads.lambdatest.com/hyperexecute/windows/hyperexecute.exe
        shell: bash

      - name: Execute Test Suite
        run: |
          pwd
          echo "Executing tests on HyperExecute..."
          ./hyperexecute --user $LT_USERNAME --key $LT_ACCESS_KEY --config yaml/failfast.yaml
        shell: bash
